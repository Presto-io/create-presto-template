NAME := {{name}}
BINARY := presto-template-$(NAME)

build:
	cargo build --release
	cp target/release/$(BINARY) ./$(BINARY)

preview: build
	mkdir -p ~/.presto/templates/$(NAME)
	cp $(BINARY) ~/.presto/templates/$(NAME)/$(BINARY)
	./$(BINARY) --manifest > ~/.presto/templates/$(NAME)/manifest.json
	@echo "✓ 模板已安装到 ~/.presto/templates/$(NAME)/"
	@echo "  请在 Presto 中刷新模板列表查看效果"

test: build
	./$(BINARY) --manifest | python3 -m json.tool > /dev/null
	./$(BINARY) --example | ./$(BINARY) > /dev/null
	@echo "✓ 所有测试通过"

clean:
	cargo clean
	rm -f $(BINARY)

.PHONY: build preview test clean
